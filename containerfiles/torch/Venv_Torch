@@ BUILD_ARGS @@

FROM $BASE_IMAGE:$BASE_IMAGE_TAG

ARG BASE_IMAGE
ARG BASE_IMAGE_TAG
ARG PYTORCH_TRITON_URL
ARG TORCHAUDIO_URL
ARG TORCHVISION_URL
ARG TORCH_URL
ARG XFORMERS_URL

RUN set -ue; \
  python3.12 -m venv /opt/venv; \
  . /opt/venv/bin/activate; \
  pip install $PYTORCH_TRITON_URL $TORCHAUDIO_URL $TORCHVISION_URL $TORCH_URL $XFORMERS_URL; \
  pip cache purge; \
  echo "source /opt/venv/bin/activate" >> ~/.bashrc;

ENV PATH="/opt/venv/bin:$PATH"

CMD ["/bin/bash"]
